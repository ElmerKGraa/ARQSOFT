# Quality Requirements (Arc42 Chapter 10)

**Project**: Library Management System (PSOFT-G1)
**Date**: 2025-11-02
**Version**: 2.0
**Status**: Extracted from Implementation

---

## Overview

This chapter describes the quality requirements for the Library Management System, structured according to the arc42 template and ISO/IEC 25010:2023 quality model. Quality requirements define **how** the system should behave rather than **what** it should do, establishing measurable criteria for system success.

Our quality requirements prioritize **security**, **maintainability**, and **testability** as critical attributes for an academic project handling sensitive library data. Performance and scalability requirements are calibrated for typical library usage patterns (up to 50 concurrent users) without over-engineering.

---

## Quality Goals

The following quality goals have the highest priority and shape fundamental architectural decisions:

| Priority | Quality Goal | Motivation | Impact on Architecture |
|----------|-------------|------------|------------------------|
| 1 | **Security** | Protects sensitive user data, financial information (fines), and ensures role-based access control for library operations | JWT with RSA authentication, BCrypt password hashing, RBAC at endpoint level, multi-layer input validation |
| 2 | **Maintainability** | Academic project requiring clear structure, extensibility, and educational value for learning software architecture principles | Layered architecture (3-tier), DDD patterns with value objects, dependency injection, externalized configuration |
| 3 | **Testability** | Enables comprehensive validation of correctness, regression prevention, and serves as living documentation | Interface-based design, dependency injection for mocking, clear layer boundaries, 23 test files |

---

## Quality Attribute Tree

The following quality attribute tree decomposes "quality" into specific, measurable requirements organized by ISO/IEC 25010 categories:

```
Quality
├── Security (Critical Priority - 23%)
│   ├── Authentication: JWT with RSA-512 asymmetric encryption, stateless tokens
│   ├── Authorization: RBAC with 3 roles (ADMIN, LIBRARIAN, READER), endpoint-level enforcement
│   ├── Confidentiality: BCrypt password hashing (work factor 10+), HTTPS support, no plaintext secrets
│   ├── Input Validation: Jakarta Bean Validation + domain logic, prevents injection attacks
│   └── Session Management: Stateless (no server-side sessions), all state in JWT
│
├── Performance (High Priority - 17%)
│   ├── Response Time: p95 < 500ms for API requests under normal load (≤50 concurrent users)
│   ├── Concurrency: Optimistic locking (@Version) on all mutable entities, prevents lost updates
│   ├── Pagination: All collection endpoints support pagination, prevents memory exhaustion
│   ├── Database Efficiency: Connection pooling, JPA query optimization, indexes on unique constraints
│   └── File Upload: 200MB max file size, 20KB max photo size, 2KB disk write threshold
│
├── Reliability (High Priority - 13%)
│   ├── Data Integrity: Database constraints (unique, not-null, foreign keys) + domain validation
│   ├── Transaction Management: ACID transactions for all data modifications via Spring @Transactional
│   ├── Error Handling: Global exception handler, consistent HTTP status codes, no stack traces exposed
│   └── Data Persistence: File-based H2 database for durability (vs in-memory mode)
│
├── Maintainability (High Priority - 17%)
│   ├── Modularity: 7 domain modules, 3-layer architecture, clear separation of concerns
│   ├── Testability: Dependency injection, interface-based services, constructor injection
│   ├── Documentation: Domain model, glossary, 44 use cases, Swagger/OpenAPI, Postman collections
│   ├── Configuration: Externalized in properties files (application.properties, library.properties)
│   └── Dependency Management: Maven/Gradle with Spring Boot dependency management
│
├── Usability (Medium Priority - 13%)
│   ├── API Documentation: Interactive Swagger UI at /swagger-ui, 100% endpoint coverage
│   ├── RESTful Design: Resource-based URLs, standard HTTP verbs, consistent response formats
│   ├── Error Messages: Clear, actionable messages with appropriate HTTP status codes
│   └── API Evolution: Structure supports future versioning (currently implicit v1)
│
├── Scalability (Medium Priority - 7%)
│   ├── Horizontal Scalability: Stateless architecture enables multiple instances behind load balancer
│   └── Database Migration: JPA abstraction supports migration from H2 to PostgreSQL/MySQL
│
├── Portability (Medium Priority - 7%)
│   ├── Platform Independence: Java 17+ runs on any OS (Windows, Linux, macOS)
│   └── Containerization: JAR packaging suitable for Docker (no Dockerfile provided yet)
│
├── Compliance (Medium Priority - 10%)
│   ├── GDPR: Consent management fields (gdprConsent, marketingConsent, thirdPartySharingConsent)
│   ├── Data Retention: Manual data management (automatic retention policies not implemented)
│   └── Audit Trail: Entity timestamps for implicit audit (dedicated audit log not implemented)
│
└── Interoperability (Medium Priority - 10%)
    ├── REST API Standard: HTTP/HTTPS, JSON serialization, OpenAPI 3.0 specification
    ├── External Integration: API Ninjas service for historical events, abstracted via service interface
    └── Client Support: Postman collections with environment variables, example requests
```

---

## Quality Scenarios

Quality scenarios provide concrete, testable descriptions of how the system should respond to stimuli. These scenarios validate our quality requirements through measurable criteria.

### Security Scenarios

**Scenario SEC-1: Stateless Authentication**
- **Context**: Client application needs to access protected library resources
- **Stimulus**: User submits valid credentials to `/api/auth/login`
- **Response**: System generates JWT token with RSA-512 signature containing user roles and expiration
- **Metrics**: Token validation completes in <100ms, token contains all necessary claims, zero unauthorized access
- **Evidence**: [SecurityConfig.java:179-191](Original/src/main/java/pt/psoft/g1/psoftg1/configuration/SecurityConfig.java#L179-L191)

**Scenario SEC-2: Role-Based Authorization**
- **Context**: Reader user attempts to access librarian-only functionality
- **Stimulus**: Reader sends POST request to `/api/authors` (create author - librarian only)
- **Response**: System validates JWT claims, detects insufficient privileges, returns 403 Forbidden
- **Metrics**: 100% enforcement of role-based access rules, zero privilege escalation
- **Evidence**: [SecurityConfig.java:110-172](Original/src/main/java/pt/psoft/g1/psoftg1/configuration/SecurityConfig.java#L110-L172)

**Scenario SEC-3: Input Validation**
- **Context**: Client submits book data with invalid ISBN format
- **Stimulus**: POST `/api/books` with ISBN "invalid-format"
- **Response**: System validates at domain boundary, rejects request, returns 400 Bad Request with message "Invalid ISBN format"
- **Metrics**: Zero invalid data persisted to database, validation error messages are actionable
- **Evidence**: [ISBN.java](Original/src/main/java/pt/psoft/g1/psoftg1/bookmanagement/model/Isbn.java), [GlobalExceptionHandler.java](Original/src/main/java/pt/psoft/g1/psoftg1/exceptions/GlobalExceptionHandler.java)

### Performance Scenarios

**Scenario PERF-1: Concurrent Updates**
- **Context**: Two librarians simultaneously update the same book record
- **Stimulus**: Both submit PATCH requests to `/api/books/{isbn}` with version=5 within 100ms of each other
- **Response**: First request succeeds (book updated to version=6), second request fails with 409 Conflict (StaleObjectStateException)
- **Metrics**: Zero lost updates, clients receive clear conflict indication, retry succeeds with fresh data
- **Evidence**: [Book.java:27-29](Original/src/main/java/pt/psoft/g1/psoftg1/bookmanagement/model/Book.java#L27-L29), version check at [Book.java:94-96](Original/src/main/java/pt/psoft/g1/psoftg1/bookmanagement/model/Book.java#L94-L96)

**Scenario PERF-2: Large Result Sets**
- **Context**: Library has 1000+ books in catalog
- **Stimulus**: Client requests GET `/api/books` without pagination parameters
- **Response**: System returns first page (default 20 items) with pagination metadata (total, pageNumber, pageSize)
- **Metrics**: Response time <500ms regardless of total catalog size, memory usage bounded
- **Evidence**: [Page.java](Original/src/main/java/pt/psoft/g1/psoftg1/shared/services/Page.java), [SearchRequest.java](Original/src/main/java/pt/psoft/g1/psoftg1/shared/services/SearchRequest.java)

### Reliability Scenarios

**Scenario REL-1: Data Integrity Under Validation Failure**
- **Context**: Client attempts to create lending with invalid data (null book reference)
- **Stimulus**: POST `/api/lendings` with missing required field `bookIsbn`
- **Response**: Validation fails at multiple levels (Bean Validation → Domain Validation → Database Constraint), transaction rolls back, returns 400 Bad Request
- **Metrics**: Zero invalid records in database, no orphaned data, referential integrity maintained
- **Evidence**: [Lending.java:55-66](Original/src/main/java/pt/psoft/g1/psoftg1/lendingmanagement/model/Lending.java#L55-L66), JPA constraints

**Scenario REL-2: Consistent Error Handling**
- **Context**: System encounters unexpected exception during book creation
- **Stimulus**: POST `/api/books` triggers runtime exception in service layer
- **Response**: GlobalExceptionHandler catches exception, logs details, returns 500 Internal Server Error with sanitized message (no stack trace)
- **Metrics**: No stack traces exposed to clients, all exceptions logged, consistent error response format
- **Evidence**: [GlobalExceptionHandler.java](Original/src/main/java/pt/psoft/g1/psoftg1/exceptions/GlobalExceptionHandler.java)

### Maintainability Scenarios

**Scenario MAINT-1: Changing Business Rules**
- **Context**: Library policy changes lending duration from 15 to 21 days
- **Stimulus**: Administrator updates `lendingDurationInDays=21` in `library.properties`
- **Response**: Application reads new value on startup, all lending operations use 21-day duration without code changes
- **Metrics**: Configuration change applied without recompilation, zero code modifications required
- **Evidence**: [library.properties](Original/src/main/resources/config/library.properties)

**Scenario MAINT-2: Adding New Feature to Module**
- **Context**: Developer needs to add new book search capability by genre
- **Stimulus**: Developer locates bookmanagement module, adds method to BookRepository, implements in BookService, exposes via BookController
- **Response**: Change isolated to 3 files within single module (repository, service, controller), other modules unaffected
- **Metrics**: Change impacts 1 module only, follows established pattern, layer boundaries respected
- **Evidence**: Consistent package structure across all 7 domain modules

### Usability Scenarios

**Scenario USE-1: API Discovery**
- **Context**: Frontend developer needs to understand available library endpoints
- **Stimulus**: Developer navigates to `/swagger-ui` in browser
- **Response**: Interactive documentation displays all endpoints organized by domain tags, with request/response schemas and try-it-out capability
- **Metrics**: 100% endpoint coverage, interactive testing works, documentation matches implementation
- **Evidence**: [application.properties:9-13](Original/src/main/resources/application.properties#L9-L13), OpenAPI 3.0 generation

---

## Implementation Status

The following table summarizes implementation status across quality categories:

| Quality Attribute | Total Requirements | Fully Implemented | Partially Implemented | Not Implemented |
|-------------------|-------------------|-------------------|----------------------|-----------------|
| Security | 7 | 5 (71%) | 2 (29%) | 0 |
| Performance | 5 | 3 (60%) | 2 (40%) | 0 |
| Reliability | 4 | 2 (50%) | 2 (50%) | 0 |
| Maintainability | 5 | 4 (80%) | 1 (20%) | 0 |
| Usability | 4 | 3 (75%) | 0 | 1 (25%) |
| Scalability | 2 | 0 | 2 (100%) | 0 |
| Portability | 2 | 1 (50%) | 1 (50%) | 0 |
| Compliance | 3 | 0 | 2 (67%) | 1 (33%) |
| Interoperability | 3 | 3 (100%) | 0 | 0 |
| **TOTAL** | **30** | **20 (67%)** | **8 (27%)** | **2 (6%)** |

**Key Observations**:
- **Strengths**: Security, usability, and interoperability are well-implemented with clear evidence in codebase
- **Partial Implementation**: Scalability and compliance have architectural support but lack production-ready implementation (H2 database limits horizontal scaling, GDPR consent management present but data export/erasure not implemented)
- **Gaps**: API versioning and automatic data retention policies not implemented (acceptable for academic project scope)

---

## Risks and Technical Debt

### High-Impact Risks

1. **H2 Database Scalability**: H2 embedded database limits horizontal scaling and production deployment
   - **Mitigation**: JPA abstraction enables migration to PostgreSQL/MySQL with minimal code changes
   - **Recommendation**: Test migration before production deployment

2. **Incomplete GDPR Compliance**: Right to be forgotten and data export not implemented
   - **Mitigation**: Consent management framework exists, can be extended
   - **Recommendation**: Implement GDPR data export and erasure before production use with EU users

3. **Unvalidated Performance Metrics**: Response time targets (p95 <500ms) not measured via load testing
   - **Mitigation**: Architecture supports performance goals through pagination, caching, optimistic locking
   - **Recommendation**: Conduct load testing to validate assumptions

### Technical Debt Items

1. **Test Coverage**: 23 test files present but coverage percentage not measured (target: 80%)
2. **Javadoc Coverage**: Varies across codebase, incomplete for some public APIs
3. **HTTPS Configuration**: Supported by Spring Boot but not documented for production deployment
4. **Audit Logging**: No dedicated audit trail for compliance and forensic analysis (only entity timestamps)
5. **Containerization**: No Dockerfile provided (JAR packaging supports containerization)

---

## Recommendations

Based on quality requirements analysis, prioritize the following enhancements:

### Before Production Deployment (Critical)
1. **Load Testing**: Validate NFR-PERF-01 response time targets under realistic load patterns
2. **Database Migration**: Test and document H2 → PostgreSQL migration for production scalability
3. **HTTPS Setup**: Document TLS 1.2+ configuration and certificate management
4. **GDPR Compliance**: Implement data export and right-to-erasure endpoints

### Quality Improvements (High Priority)
5. **Test Coverage**: Measure current coverage, add tests to reach 80% target
6. **Audit Logging**: Implement audit trail for create/update/delete operations
7. **Data Retention**: Define and implement retention policies per compliance requirements

### Developer Experience (Medium Priority)
8. **Javadoc**: Improve coverage for public APIs and service interfaces
9. **Containerization**: Create Dockerfile and docker-compose.yml for simplified deployment
10. **API Versioning**: Plan versioning strategy (URL-based: `/api/v1/`, `/api/v2/`) for future evolution