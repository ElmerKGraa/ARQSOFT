# Aplica√ß√£o do Processo ADD 

## STEP 1: Review Inputs 
### Identifica√ß√£o dos drivers arquiteturais:
#### Primary Functional Requirements:

- FR1: Gerar IDs em formatos configur√°veis (base65+timestamp+hex)
- FR2: Buscar ISBN por t√≠tulo em APIs externas (ISBNdb, Google Books, Open Library)
- FR3: Persistir dados em diferentes backends (SQL, MongoDB, ElasticSearch) com Redis

#### Quality Attribute Scenarios (ASR - Architecturally Significant Requirements):
| Quality Attribute | Cen√°rio | Import√¢ncia |
| Configurabilidade | Trocar estrat√©gia de gera√ß√£o de ID via properties sem recompila√ß√£o | CR√çTICA |
| Extensibilidade | Adicionar novo provider de ISBN sem modificar c√≥digo existente | ALTA |
| Modifiabilidade | Substituir backend de persist√™ncia (SQL‚ÜíMongoDB) via configura√ß√£o | CR√çTICA |
| Testabilidade | Testar cada estrat√©gia isoladamente com mocks | ALTA |
| Interoperabilidade | Integrar com m√∫ltiplas APIs externas (ISBNdb, Google Books, etc.) | M√âDIA |

##### Constraints:
- Uso obrigat√≥rio de Spring Boot/Spring Framework
- Estrutura de ID mandat√≥ria: [base65+timestamp+hexadecimal]
- Manter compatibilidade com c√≥digo legado (LendingNumber, ReaderNumber)

##### Concerns (Cross-cutting):

- Configuration management
- Dependency injection
- Exception handling
- Logging


## STEP 2: Establish Goals and Select Inputs üéØ
### Iteration Goals:
#### Itera√ß√£o 1 (FASE 1): Configurabilidade de Gera√ß√£o de IDs

- Driver Principal: Configurabilidade
- Elementos afetados: LendingNumber, ReaderNumber, outros IDs de entidades

#### Itera√ß√£o 2 (FASE 2): Extensibilidade para ISBN Lookup

- Driver Principal: Extensibilidade + Interoperabilidade
- Elementos afetados: BookServiceImpl, integra√ß√£o com APIs externas

##### Itera√ß√£o 3 (FASE 3): Modifiabilidade da Camada de Persist√™ncia

- Driver Principal: Modifiabilidade + Portabilidade
- Elementos afetados: Repositories, JpaConfig, persist√™ncia


## STEP 3: Choose Elements to Decompose üèóÔ∏è
### Elementos identificados para decomposi√ß√£o:

- ID Generation Subsystem: LendingNumber, ReaderNumber ‚Üí IdGenerator abstraction
- ISBN Lookup Subsystem: BookServiceImpl (hardcoded logic) ‚Üí IsbnLookupService abstraction
- Persistence Layer: SpringDataXxxRepository ‚Üí Repository abstraction + implementations


## STEP 4: Choose Design Concepts (Tactics & Patterns) üõ†Ô∏è
Aqui est√° o cerne da justificativa arquitetural baseada no documento ADD:

### 4.1 Tactics para CONFIGURABILIDADE (Flexibility)
Do documento ADD:

"Configuration-Driven Behavior: Allow behavior to be modified through configuration files instead of code changes."

T√°ticas Aplicadas:
| T√°tica | Implementa√ß√£o | Justificativa | 
| Configuration-Driven Behavior | `@Value`, `@ConfigurationProperties` para ler `application.properties` |Permite trocar estrat√©gias em setup time sem recompila√ß√£o | 
| Use of Abstractions | Interfaces `IdGenerator`, `IsbnLookupService`, `Repository<T>` | Permite futuras mudan√ßas com impacto m√≠nimo |
| Dynamic Binding | Spring DI injeta implementa√ß√£o baseada em properties |Binding da estrat√©gia em runtime baseado em configura√ß√£o |

### Setup time configuration
id.generation.strategy=configurable  # ou legacy
```
‚Üí Spring automaticamente injeta `ConfigurableIdGenerator` ou `LegacyIdGenerator`

---

#### **4.2 Tactics para EXTENSIBILIDADE & MODIFIABILIDADE**

Do documento ADD:
> *"Use of Plugins or Extensions: Implement a plugin architecture to allow new features without modifying core components."*
> *"Encapsulation: Group related functionality and hide internal details."*
> *"Use of Interfaces: Define interfaces for components to allow easy replacement or modification."*

**T√°ticas Aplicadas:**

| T√°tica | Implementa√ß√£o | Justificativa |
|--------|--------------|---------------|
| **Encapsulation** | Factories (`IdGeneratorFactory`, `IsbnLookupFactory`) escondem l√≥gica de cria√ß√£o | Isola complexidade de instancia√ß√£o |
| **Use of Interfaces** | `IdGenerator`, `IsbnLookupService` como contratos | Permite **substitui√ß√£o f√°cil** de implementa√ß√µes |
| **Separation of Concerns** | Camadas: Model / Repository / Service / Config | **Responsabilidade √∫nica** por camada |
| **Abstract Common Services** | `IdGenerator` reutilizado por todas as entidades | Evita **duplica√ß√£o** de l√≥gica |
| **Reduce Coupling** | Services dependem de interfaces, n√£o implementa√ß√µes | **Low coupling, high cohesion** |

---

#### **4.3 Tactics para TESTABILIDADE**

Do documento ADD:
> *"Dependency Injection: Facilitate testing by injecting dependencies."*
> *"Isolation: Design components to function independently, allowing targeted testing."*

**T√°ticas Aplicadas:**

| T√°tica | Implementa√ß√£o | Justificativa |
|--------|--------------|---------------|
| **Dependency Injection** | Constructor injection via Spring | Permite **injetar mocks** em testes |
| **Isolation** | Cada estrat√©gia √© **independente** | Testes unit√°rios **isolados** por estrat√©gia |
| **Mocking** | Interfaces facilitam uso de Mockito | Simular depend√™ncias externas (APIs, DB) |

---

#### **4.4 Architectural Patterns (Design Concepts)**

Do documento ADD:
> *"Design concepts are building blocks from which the design is created: Reference Architectures, Deployment patterns, Architecture Patterns, Tactics, and Externally developed components."*

**Padr√µes Arquiteturais Aplicados:**

| Padr√£o | Onde Aplicado | Motivo (Rela√ß√£o com Quality Attributes) |
|--------|--------------|----------------------------------------|
| **Strategy Pattern** | `IdGenerator`, `IsbnLookupService`, `Repository` | **Configurabilidade**: Trocar algoritmos/estrat√©gias em runtime |
| **Factory Pattern** | `IdGeneratorFactory`, `IsbnLookupFactory` | **Extensibilidade**: Centralizar cria√ß√£o baseada em config |
| **Adapter Pattern** | `CompositeIsbnLookupService` | **Interoperabilidade**: Adaptar m√∫ltiplas APIs externas |
| **Decorator Pattern** | `RedisBookCache` (wrapper sobre Repository) | **Performance**: Adicionar caching transparentemente |
| **Template Method** | `AbstractRepository` (se necess√°rio) | **Modifiabilidade**: C√≥digo comum reutiliz√°vel |
| **Dependency Injection** | Spring Framework | **Testabilidade + Modifiabilidade**: Injetar depend√™ncias |

---

#### **4.5 Externally Developed Components**

- **Spring Boot**: Framework base com DI container
- **Spring Data JPA**: Abstra√ß√£o para SQL
- **Spring Data MongoDB**: Suporte MongoDB
- **Spring Data Redis**: Cache layer
- **WebClient/RestTemplate**: HTTP clients para APIs externas

---

### **STEP 5: Instantiate Elements and Define Interfaces** üèõÔ∏è

**Artefatos Criados:**

#### **FASE 1 - ID Generation:**
```
Interfaces:
  - IdGenerator (contract)
Implementations:
  - ConfigurableIdGenerator (novo formato)
  - LegacyIdGenerator (formato antigo)
Factories:
  - IdGeneratorFactory
Configuration:
  - IdGeneratorProperties
  - IdGeneratorConfig
```

#### **FASE 2 - ISBN Lookup:**
```
Interfaces:
  - IsbnLookupService (contract)
Implementations:
  - IsbnDbLookupService
  - GoogleBooksLookupService
  - OpenLibraryLookupService
  - CompositeIsbnLookupService (combina 2)
Factories:
  - IsbnLookupFactory
Configuration:
  - IsbnLookupProperties
  - IsbnLookupConfig
```

#### **FASE 3 - Persistence:**
```
Interfaces:
  - BookRepository (abstra√ß√£o gen√©rica)
Implementations:
  - JpaSqlBookRepository
  - MongoBookRepository
  - ElasticSearchBookRepository
Decorators:
  - RedisBookCache (caching layer)
Factories:
  - RepositoryFactory
Configuration:
  - PersistenceProperties
  - PersistenceConfig
```

---

### **STEP 6: Sketch Views and Record Decisions** üìê

**Principais Decis√µes Arquiteturais:**

| ID | Decis√£o | Rationale | Trade-offs |
|----|---------|-----------|----------|
| D1 | Usar Strategy Pattern para ID generation | Permite configurabilidade sem if/else hardcoded | Complexidade adicional inicial |
| D2 | Factory baseada em Properties | Centraliza l√≥gica de cria√ß√£o, facilita testes | Mais classes criadas |
| D3 | Interfaces para todas as estrat√©gias | Open/Closed Principle, extensibilidade | Overhead de abstra√ß√µes |
| D4 | Redis como cache universal | Performance, reduz carga no DB prim√°rio | Depend√™ncia adicional |
| D5 | Composite para combinar ISBN providers | Fallback autom√°tico, resili√™ncia | Lat√™ncia aumentada |

---

### **STEP 7: Perform Analysis and Review** ‚úÖ

**Verifica√ß√£o dos Quality Attributes:**

| Quality Attribute | Como √© atendido | Evid√™ncia |
|------------------|----------------|-----------|
| **Configurabilidade** | ‚úÖ Trocar estrat√©gia via properties | Nenhum c√≥digo recompilado, apenas config alterado |
| **Extensibilidade** | ‚úÖ Adicionar nova estrat√©gia sem modificar existentes | Criar nova classe que implementa interface |
| **Modifiabilidade** | ‚úÖ Substituir backend de persist√™ncia | Alterar `persistence.strategy` em properties |
| **Testabilidade** | ‚úÖ Testar cada estrat√©gia isoladamente | Mocks facilmente injetados via DI |
| **Interoperabilidade** | ‚úÖ Integrar com m√∫ltiplas APIs | Adapter pattern, HTTP clients configur√°veis |
| **Reliability** | ‚úÖ Composite ISBN lookup com fallback | Se API 1 falha, tenta API 2 |

---

## üîÅ Iterative Design (Step 8: Refine as Necessary)

Processo iterativo conforme ADD:
1. **Itera√ß√£o 1**: ID Generation (Configurabilidade) ‚Üí **Validar** com testes
2. **Itera√ß√£o 2**: ISBN Lookup (Extensibilidade) ‚Üí **Refinar** baseado em feedback
3. **Itera√ß√£o 3**: Persistence (Modifiabilidade) ‚Üí **Revisar** trade-offs

---

## üìä Mapeamento: T√°ticas ‚Üî Quality Attributes ‚Üî Implementa√ß√£o
```
CONFIGURABILIDADE (Critical)
‚îú‚îÄ Configuration-Driven Behavior
‚îÇ  ‚îî‚îÄ application.properties + @ConfigurationProperties
‚îú‚îÄ Dynamic Binding
‚îÇ  ‚îî‚îÄ Spring DI + Factories
‚îî‚îÄ Use of Abstractions
   ‚îî‚îÄ IdGenerator, IsbnLookupService, Repository interfaces

EXTENSIBILIDADE (High)
‚îú‚îÄ Use of Plugins/Extensions
‚îÇ  ‚îî‚îÄ Strategy Pattern para cada subsistema
‚îú‚îÄ Encapsulation
‚îÇ  ‚îî‚îÄ Factories encapsulam l√≥gica de cria√ß√£o
‚îî‚îÄ Separation of Concerns
   ‚îî‚îÄ Model / Repository / Service / Config layers

MODIFIABILIDADE (Critical)
‚îú‚îÄ Use of Interfaces
‚îÇ  ‚îî‚îÄ Contratos bem definidos
‚îú‚îÄ Reduce Coupling
‚îÇ  ‚îî‚îÄ Depend on abstractions, not concretions
‚îî‚îÄ Abstract Common Services
   ‚îî‚îÄ IdGenerator reus√°vel

TESTABILIDADE (High)
‚îú‚îÄ Dependency Injection
‚îÇ  ‚îî‚îÄ Constructor injection
‚îú‚îÄ Isolation
‚îÇ  ‚îî‚îÄ Cada estrat√©gia independente
‚îî‚îÄ Mocking
   ‚îî‚îÄ Interfaces facilitam Mockito


## Step 1 files:

### Interface e Base:

- IdGeneratorProperties.java
- IdGeneratorConfig.java
- IdGeneratorInitializer.java

### Interface e Implementa√ß√µes:

- IdGenerator.java (interface)
- ConfigurableIdGenerator.java
- LegacyIdGenerator.java
- IdGeneratorFactory.java

### Modelos Refatorados:

- LendingNumber_Updated.java
- ReaderNumber_Updated.java

## Step 2 files:

### Interface e Base:

- IsbnLookupService.java (interface)
- AbstractIsbnLookupService.java
- IsbnLookupException.java

### Providers (APIs Externas):

- GoogleBooksLookupService.java
- OpenLibraryLookupService.java
- IsbnDbLookupService.java

### Composite (Fallback Autom√°tico):

- CompositeIsbnLookupService.java

### Configuration:

- IsbnLookupProperties.java
- IsbnLookupFactory.java
- IsbnLookupConfig.java

### Integra√ß√£o com BookService:

- BookServiceImpl_Updated.java

## Step 3 files:

- PersistenceProperties.java
- CacheService.java
- RedisCacheService.java
- CachedBookRepository.java
- MongoBookRepository.java
- RedisConfig.java
- PersistenceConfig.java